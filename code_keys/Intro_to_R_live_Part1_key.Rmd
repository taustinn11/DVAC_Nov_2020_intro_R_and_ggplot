---
title: "Intro_to_R_live_Part1_key"
author: "Austin Nuckols"
date: "11/3/2020"
output: html_document
---

## Intro to RStudio Editor

Open RStudio and take a look around

You have 4 panes: Source Pane, Console, Environment/History, Files/etc pane
- Console is for experimentation or quick code (x = 10)
- Environment/History shows you what objects you have saved in R and what code you have just run, respectively
- Files/etc. shows a lot of things
  - Files shows the files in your current 'working directory'
    - You may remember directories from the Bash/Linux workshop
    - Your working directory is just the folder that you're currently in -- we'll talk more about that in a minute
    - *When working in R outside of an R Project (we are in a project right now), you'll need to be sure that you set your working directory. Otherwise, R will not be able to find any files/data you try to reference*
  - Plots is self-explanatory
  - Packages just shows your package library and the ones that are currently loaded. You can mostly ignore this
  - Help can be used to look up the help page of a function (help(mean))
  - Viewer is for some other outputs that aren't plots
- Source is where scripts (or similar file types) you are working on will go.    - Importantly, what you put in your console should be considered NOT saved, so code that you like should always be put into the script file

You can open a script file in the top left corner by clicking the white sheet with a green plus on it, or by choosing File > New File > R Script. Also, if you want to take notes directly in the editor, I recommend using an R Markdown file which will let you separate code and regular text. When I say "script" in this workshop moving forward, I will be referring to any of these file types

If you want to change any settings, you should go to Tools > Global Options which will open a window where you can customize your theme as well as several other features of RStudio

Any major questions?

## Code

Let's talk about some code

### Run code

To run code you can press enter in the Console or press Ctrl+Enter (or Cmd+Enter for Mac) when in a script/chunk.

If you are in Rmd right now, choose the Insert option (just above the source pane w/ Green square with a c and a plus) and choose 'R' to insert an R chunk. In Rmd this is how code is separated from text and can run

Shortcut: Ctrl+Alt+I - this inserts a chunk

```{r}
4+8
```

In script, be sure your cursor is in the code you want to run. 

You can also highlight the code and click Run on the top right, but this is slower, so I don't recommend it

### Comments

If you're in a script file (like me) you'll use # to indicate a comment. 

In your coding space, type # and say this is a comment and try to run it -- it didn't do anything right?

You can put comments in the same line as actual code as long as it's after the code, and your code will run while the comment will not

```{r}
# Comments are not run as code and are great for leaving notes in your code
```

```{r}
x # Add another comment
```

In a chunk, let's assign a new variable:
  Ctrl+Alt+I - this inserts a chunk
  
  Another shortcut that's nice is the assignment shortcut:
    Alt + - (Alt + the minus sign)

```{r}
y <- 8 # This is our new object 'y'
```

Questions? 

## Practical Data Examples

### Up top items

Now we are going to read in some data. In this tutorial, we are going to use the tidyverse package, the lubridate package, and the here package. If you have not already installed them, please do now using

```{r eval=FALSE}
install.packages("tidyverse", "lubridate", "here")
```

While this installs, I'll talk about packages. Packages simply put are just a collection of functions that were built for a specific purpose. You get to use the shorthand function, and the file that defines the function in the package actually just contains instructions that R can use on the back end to convert the function into base R commands.

The tidyverse is actually a suite of packages that are meant to simplify R programming and empower the users. We are going to work using functions from within tidyverse packages

After you've installed it (or if it was previously installed), we need to load it using library()

```{r}
library(tidyverse)
library(here)
```

library() tells R to load the package to the current session so that it can be used. Not all libraries are loaded all of the time because sometimes, their functions conflict with functions in other packages. Therefore, it is necessary to load a library when you want to use it

Now we need to ensure that our working directory is set. The working directory (see the Files pane) is simply where R starts when it needs to look for files/data. Setting your working directory is crucial. This is why we use the 'here' package.

In the console, we need to type the following code:
`getwd()`

It should say "~/DVAC_Nov_2020_intro_R_and_ggplot"
i.e. it should match the output of `here()`

If it does not, run `setwd(here())`

### HEK WB Data

Now let's get into the actual data

Let's say I have some WB quantification data for different HEK cell samples. However, I have two data files, one more updated than the other, and I want to clean the first one and then join it together with the more updated one and save it as a new file

Here we are reading the data which is saved in the data/part1/ folder as a .csv file

```{r}
setwd(here())
hek1 <- read_csv("data/part1/10.23.19_hek.csv")
hek2 <- read_csv("data/part1/hek_wb_combined.csv")
```

Let's go over some functions you can use to take a peek at your data

```{r}
head(hek1); head(hek2)
view(hek1)
view(hek2)

summary(hek1)
summary(hek2)
```

Now let's clean this data -- we're going to use a series of functions that are all "piped" together so that the output of one is the input of the next

Summary:
  Filter for new lysis methods
  remove variables that aren't useful
  rename a variable so that it matches the other data set
  add a date variable
  
  Join the data
  Make corrected value by dividing the value by the total protein signal
  drop the unused variables
  
  Draw up a summary table that I can view

```{r}
library(lubridate)

hek1_clean <- hek1 %>% 
  filter(lysis == "new") %>% 
  select(-c(lysis, blotid)) %>% 
  rename(total_protein_signal = tp) %>% 
  mutate(date = mdy("10-23-19"))

hek_combined_clean <- full_join(hek1_clean, hek2) %>% 
  mutate(value_corrected = value/total_protein_signal) %>% 
  select(-c(value, total_protein_signal))

hek_combined_clean %>% 
  group_by(sampleid, protein) %>% 
  summarise(ave = mean(value_corrected),
            sd = sd(value_corrected)) %>% 
  arrange(protein)
```

Now let's experiment with different ways of graphing this data using ggplot

On ggplot:
  The "gg" stands for Grammar of Graphics (https://vita.had.co.nz/papers/layered-grammar.html)
  
  In short, the grammar of graphics states that graphs are generated layer by layer, with elements being stacked on top of one another. We can illustrate this with our WB example

```{r}
hek_combined_clean %>% 
  ggplot(aes(x = protein, y = value_corrected, fill = sampleid))+
  geom_boxplot()+
  facet_wrap(facets = ~date)
  #geom_point()

hek_combined_clean %>% 
  filter(date > mdy("10-23-2019")) %>% 
  ggplot(aes(x = sampleid, y = value_corrected, fill = protein))+
  geom_boxplot()+
  facet_wrap(~protein,
             scales = "free")+
  xlab("")+
  ylab("Corrected Intensity (A.U.)")+
  ggtitle("There is no difference between the samples for these proteins")+
  labs(fill = "Protein ID")+
  theme_bw()
```

### Enzyme Contaminants

Now let's say I have some enzyme assay data that I've taken at a few time points

I want to plot the change in values for the different samples over time. Some of my proteins are contaminated with an enzyme, and I need to see if they have enzymatic activity just on their own

```{r}
ts <- read_csv("../data/part1/enzyme_contaminants_ts.csv")
```

```{r}
head(ts)
```

There is not really much to clean from this data. However, we see that the data is in a "wide" or a "spread out" format. While it was more convenient to collect the data like this, I ideally want to pull the time variable (which is currently spread horizontally) to be vertical
  This may be referred to as "melting" the data frame (in Python). 
In R, this is called "pivoting" the data
  Essentially, you take this output and pivot it from wide to long format. It is better understood when seen in action

```{r}
ts_cleaned <- ts %>%
  pivot_longer(
    contains("t"),
    names_to = "time_point",
    values_to = "value",
    names_prefix = "t"
  ) %>%
  mutate(time_point = as.numeric(time_point))
```

```{r}
ts_cleaned %>% 
  ggplot(aes(x = time_point, y = value, color = sampleid))+
  geom_point()+
  geom_smooth(method = "lm",
              se = FALSE)+
  xlab("Time (min)")+
  ylab("Fluorescence (A.U.)")+
  labs(color = "")+
  ggtitle("Protein A has identical activity to the enzyme itself!")+
  theme_classic()
```

### DRC

